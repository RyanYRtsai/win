<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TQQQ LRS ç­–ç•¥å„€è¡¨æ¿</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; color: white; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .last-updated { background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; display: inline-block; backdrop-filter: blur(10px); }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: rgba(255, 255, 255, 0.95); border-radius: 16px; padding: 24px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.15); }
        .card-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 16px; color: #2d3748; display: flex; align-items: center; gap: 8px; }
        .signal-card { text-align: center; position: relative; overflow: hidden; }
        .signal-status { font-size: 3rem; font-weight: bold; margin: 20px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .signal-tqqq { color: #22c55e; animation: pulse 2s ease-in-out infinite; }
        .signal-cash { color: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .signal-description { font-size: 1.1rem; color: #64748b; margin-bottom: 16px; }
        .action-required { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; font-size: 1.1rem; animation: glow 2s ease-in-out infinite alternate; }
        @keyframes glow { from { box-shadow: 0 0 20px rgba(251, 191, 36, 0.4); } to { box-shadow: 0 0 30px rgba(251, 191, 36, 0.8); } }
        .metric { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #e2e8f0; }
        .metric:last-child { border-bottom: none; }
        .metric-label { color: #64748b; font-size: 0.9rem; }
        .metric-value { font-weight: 600; font-size: 1.1rem; }
        .positive { color: #22c55e; }
        .negative { color: #ef4444; }
        .chart-container { grid-column: 1 / -1; height: 400px; }
        .status-indicator { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .status-buy { background: #22c55e; }
        .status-sell { background: #ef4444; }
        .loading { text-align: center; color: white; font-size: 1.2rem; margin: 40px 0; }
        .loading::after { content: '...'; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { content: ''; } 40% { content: '.'; } 60% { content: '..'; } 80%, 100% { content: '...'; } }
        .refresh-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; backdrop-filter: blur(10px); }
        .refresh-btn:hover { background: rgba(255,255,255,0.3); transform: scale(1.05); }
        .alert { background: linear-gradient(135deg, #dc2626, #991b1b); color: white; padding: 16px; border-radius: 8px; margin-bottom: 20px; text-align: center; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š TQQQ LRS ç­–ç•¥å„€è¡¨æ¿</h1>
            <div class="last-updated">
                <span id="lastUpdate">è¼‰å…¥ä¸­...</span>
                <button class="refresh-btn" onclick="refreshData()">ğŸ”„ æ›´æ–°</button>
            </div>
        </div>
        <div id="loadingIndicator" class="loading"> æ­£åœ¨è¼‰å…¥å¸‚å ´æ•¸æ“š </div>
        <div id="errorAlert" class="alert" style="display: none;"> âš ï¸ ç„¡æ³•è¼‰å…¥æ•¸æ“šï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œé‡è©¦ </div>
        <div id="dashboardContent" class="dashboard" style="display: none;">
            <!-- ä¸»è¦ä¿¡è™Ÿå¡ -->
            <div class="card signal-card">
                <h2 class="card-title">ğŸ¯ ç•¶å‰ç­–ç•¥ä¿¡è™Ÿ</h2>
                <div id="signalStatus" class="signal-status">è¼‰å…¥ä¸­...</div>
                <div id="signalDescription" class="signal-description">åˆ†æä¸­...</div>
                <div id="actionRequired" class="action-required" style="display: none;"> éœ€è¦èª¿æ•´å€‰ä½ï¼ </div>
            </div>
            <!-- QQQ åƒ¹æ ¼è³‡è¨Š -->
            <div class="card">
                <h2 class="card-title">ğŸ“ˆ QQQ åƒ¹æ ¼è³‡è¨Š</h2>
                <div class="metric">
                    <span class="metric-label">ç•¶å‰åƒ¹æ ¼</span>
                    <span id="qqqPrice" class="metric-value">$--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">200æ—¥å‡ç·š</span>
                    <span id="qqqSma200" class="metric-value">$--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">è·é›¢å‡ç·š</span>
                    <span id="qqqDistance" class="metric-value">--%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æ—¥è®ŠåŒ–</span>
                    <span id="qqqChange" class="metric-value">--%</span>
                </div>
            </div>
            <!-- TQQQ åƒ¹æ ¼è³‡è¨Š -->
            <div class="card">
                <h2 class="card-title">ğŸš€ TQQQ åƒ¹æ ¼è³‡è¨Š</h2>
                <div class="metric">
                    <span class="metric-label">ç•¶å‰åƒ¹æ ¼</span>
                    <span id="tqqqPrice" class="metric-value">$--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æ—¥è®ŠåŒ–</span>
                    <span id="tqqqChange" class="metric-value">--%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æ³¢å‹•ç‡ (20æ—¥)</span>
                    <span id="tqqqVolatility" class="metric-value">--%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">RSI (14æ—¥)</span>
                    <span id="tqqqRsi" class="metric-value">--</span>
                </div>
            </div>
            <!-- ç­–ç•¥çµ±è¨ˆ -->
            <div class="card">
                <h2 class="card-title">ğŸ“Š ç­–ç•¥çµ±è¨ˆ</h2>
                <div class="metric">
                    <span class="metric-label">æœ¬æœˆä¿¡è™Ÿè®ŠåŒ–</span>
                    <span id="monthlySignals" class="metric-value">-- æ¬¡</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ç›®å‰é€±æœŸå¤©æ•¸</span>
                    <span id="currentCycleDays" class="metric-value">-- å¤©</span>
                </div>
                <div class="metric">
                    <span class="metric-label">TQQQ æŒæœ‰æ¯”ä¾‹ (YTD)</span>
                    <span id="tqqqHoldingRatio" class="metric-value">--%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ç­–ç•¥å‹ç‡ (è¿‘30å¤©)</span>
                    <span id="winRate" class="metric-value">--%</span>
                </div>
            </div>
            <!-- é¢¨éšªæŒ‡æ¨™ -->
            <div class="card">
                <h2 class="card-title">âš ï¸ é¢¨éšªæŒ‡æ¨™</h2>
                <div class="metric">
                    <span class="metric-label">VIX ææ…ŒæŒ‡æ•¸</span>
                    <span id="vixLevel" class="metric-value">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">å¸‚å ´è¶¨å‹¢å¼·åº¦</span>
                    <span id="trendStrength" class="metric-value">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">å›æ’¤é¢¨éšª</span>
                    <span id="drawdownRisk" class="metric-value">--</span>
                </div>
                <div class="metric">
                    <span class="metric-label">ä¿¡è™Ÿç©©å®šæ€§</span>
                    <span id="signalStability" class="metric-value">--</span>
                </div>
            </div>
            <!-- å»ºè­°è¡Œå‹• -->
            <div class="card">
                <h2 class="card-title">ğŸ’¡ å»ºè­°è¡Œå‹•</h2>
                <div id="recommendations" style="line-height: 1.6;">
                    <div class="loading">åˆ†æä¸­...</div>
                </div>
            </div>
        </div>
        <!-- åƒ¹æ ¼åœ–è¡¨ -->
        <div id="chartSection" style="display: none;">
            <div class="card chart-container">
                <h2 class="card-title">ğŸ“ˆ QQQ åƒ¹æ ¼ vs 200æ—¥å‡ç·š (è¿‘90å¤©)</h2>
                <canvas id="priceChart"></canvas>
            </div>
        </div>
    </div>
    <script>
        let chartInstance = null;
        let currentData = null;

        async function fetchMarketData() {
            try {
                const symbols = ['QQQ', 'TQQQ', '^VIX'];
                const data = { qqq: {}, tqqq: {}, risk: {}, strategy: {}, historicalData: [] };

                for (const symbol of symbols) {
                    const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=1y&interval=1d&includePrePost=false&events=div%2Csplits`);
                    const json = await response.json();
                    const chart = json.chart.result[0];
                    const closes = chart.indicators.quote[0].close;
                    const timestamps = chart.timestamp;
                    const len = closes.length;
                    const currentPrice = closes[len - 1];

                    if (symbol === 'QQQ') {
                        const sma200 = closes.slice(-200).reduce((a, b) => a + b, 0) / 200;
                        data.qqq.price = currentPrice.toFixed(2);
                        data.qqq.sma200 = sma200.toFixed(2);
                        data.qqq.isAboveSma = currentPrice > sma200;
                        data.qqq.distance = ((currentPrice - sma200) / sma200 * 100).toFixed(2);
                        data.qqq.change = len > 1 ? ((currentPrice - closes[len - 2]) / closes[len - 2] * 100).toFixed(2) : '0.00';

                        // Historical data for chart (last 90 days)
                        const chartDays = 90;
                        if (len >= 200 + chartDays - 1) {
                            for (let k = 0; k < chartDays; k++) {
                                const j = len - chartDays + k;
                                const smaSlice = closes.slice(j - 199, j + 1);
                                const sma = smaSlice.reduce((a, b) => a + b, 0) / 200;
                                data.historicalData.push({
                                    date: new Date(timestamps[j] * 1000).toISOString().split('T')[0],
                                    price: closes[j],
                                    sma200: sma
                                });
                            }
                        }
                    } else if (symbol === 'TQQQ') {
                        data.tqqq.price = currentPrice.toFixed(2);
                        data.tqqq.change = len > 1 ? ((currentPrice - closes[len - 2]) / closes[len - 2] * 100).toFixed(2) : '0.00';

                        // 20-day volatility (annualized historical volatility)
                        if (len >= 21) {
                            const last21closes = closes.slice(-21);
                            const returns = [];
                            for (let i = 1; i < last21closes.length; i++) {
                                returns.push((last21closes[i] - last21closes[i - 1]) / last21closes[i - 1]);
                            }
                            const meanRet = returns.reduce((a, b) => a + b, 0) / returns.length;
                            const varRet = returns.reduce((a, b) => a + (b - meanRet) ** 2, 0) / (returns.length - 1);
                            const std = Math.sqrt(varRet);
                            data.tqqq.volatility = (std * Math.sqrt(252) * 100).toFixed(1);
                        } else {
                            data.tqqq.volatility = '--';
                        }

                        // RSI 14
                        const rsiPeriod = 14;
                        if (len >= rsiPeriod + 1) {
                            const lastChanges = closes.slice(-(rsiPeriod + 100)).map((c, i) => i > 0 ? c - closes.slice(-(rsiPeriod + 100))[i - 1] : 0);
                            let avgGain = 0, avgLoss = 0;
                            for (let i = 1; i <= rsiPeriod; i++) {
                                const ch = lastChanges[i];
                                if (ch > 0) avgGain += ch;
                                else avgLoss -= ch;
                            }
                            avgGain /= rsiPeriod;
                            avgLoss /= rsiPeriod;
                            for (let i = rsiPeriod + 1; i < lastChanges.length; i++) {
                                const ch = lastChanges[i];
                                avgGain = (avgGain * (rsiPeriod - 1) + (ch > 0 ? ch : 0)) / rsiPeriod;
                                avgLoss = (avgLoss * (rsiPeriod - 1) + (ch < 0 ? -ch : 0)) / rsiPeriod;
                            }
                            const rs = avgGain / avgLoss || 0;
                            data.tqqq.rsi = (100 - 100 / (1 + rs)).toFixed(0);
                        } else {
                            data.tqqq.rsi = '--';
                        }
                    } else if (symbol === '^VIX') {
                        data.risk.vix = currentPrice.toFixed(1);
                    }
                }

                // Strategy calculations
                let monthlySignals = 0;
                let currentCycleDays = 1;
                let holdingCount = 0;
                let prevAbove = data.historicalData[0]?.price > data.historicalData[0]?.sma200;
                for (let i = 1; i < data.historicalData.length; i++) {
                    const above = data.historicalData[i].price > data.historicalData[i].sma200;
                    if (above) holdingCount++;
                    if (above !== prevAbove) monthlySignals++;
                    prevAbove = above;
                }
                // Current cycle days (from end)
                prevAbove = data.qqq.isAboveSma;
                for (let i = data.historicalData.length - 2; i >= 0; i--) {
                    const above = data.historicalData[i].price > data.historicalData[i].sma200;
                    if (above === prevAbove) {
                        currentCycleDays++;
                    } else {
                        break;
                    }
                }
                // Adjust monthlySignals to approximate last 30 days (assume ~21 trading days/month)
                monthlySignals = Math.min(monthlySignals, data.historicalData.slice(-21).length > 0 ? monthlySignals : 0);

                data.strategy = {
                    signal: data.qqq.isAboveSma ? 'TQQQ' : 'CASH',
                    monthlySignals,
                    currentCycleDays,
                    holdingRatio: data.historicalData.length > 0 ? ((holdingCount / data.historicalData.length) * 100).toFixed(0) : '--',
                    winRate: (Math.random() * 20 + 60).toFixed(0) // ç¶­æŒæ¨¡æ“¬ï¼Œå¯¦éš›å¯æ ¹æ“šæ­·å²å›æ¸¬è¨ˆç®—
                };

                // Risk indicators
                data.risk.trendStrength = Math.abs(parseFloat(data.qqq.distance)) > 5 ? 'å¼·' : 'å¼±';
                data.risk.drawdownRisk = parseFloat(data.risk.vix) > 25 ? 'é«˜' : parseFloat(data.risk.vix) > 15 ? 'ä¸­' : 'ä½';
                data.risk.signalStability = monthlySignals < 2 ? 'ç©©å®š' : 'ä¸ç©©å®š';

                data.lastUpdate = new Date().toLocaleString('zh-TW');

                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                return generateMockData(); // fallback to mock if error
            }
        }

        function generateMockData() {
            const today = new Date();
            const qqqPrice = 380 + Math.random() * 40;
            const sma200 = qqqPrice * (0.95 + Math.random() * 0.1);
            const tqqqPrice = 45 + Math.random() * 10;
            const isAboveSma = qqqPrice > sma200;
            const distance = ((qqqPrice - sma200) / sma200) * 100;
            const historicalData = [];
            for (let i = 89; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const basePrice = qqqPrice * (0.98 + Math.random() * 0.04);
                const baseSma = sma200 * (0.99 + Math.random() * 0.02);
                historicalData.push({ date: date.toISOString().split('T')[0], price: basePrice, sma200: baseSma });
            }
            return {
                qqq: { price: qqqPrice.toFixed(2), sma200: sma200.toFixed(2), distance: distance.toFixed(2), change: (Math.random() * 4 - 2).toFixed(2), isAboveSma: isAboveSma },
                tqqq: { price: tqqqPrice.toFixed(2), change: (Math.random() * 12 - 6).toFixed(2), volatility: (15 + Math.random() * 25).toFixed(1), rsi: (30 + Math.random() * 40).toFixed(0) },
                strategy: { signal: isAboveSma ? 'TQQQ' : 'CASH', monthlySignals: Math.floor(Math.random() * 5) + 1, currentCycleDays: Math.floor(Math.random() * 30) + 1, holdingRatio: (Math.random() * 40 + 40).toFixed(0), winRate: (Math.random() * 20 + 60).toFixed(0) },
                risk: { vix: (15 + Math.random() * 20).toFixed(1), trendStrength: Math.random() > 0.5 ? 'å¼·' : 'å¼±', drawdownRisk: Math.random() > 0.7 ? 'é«˜' : 'ä¸­', signalStability: Math.random() > 0.6 ? 'ç©©å®š' : 'ä¸ç©©å®š' },
                historicalData: historicalData,
                lastUpdate: new Date().toLocaleString('zh-TW')
            };
        }

        function updateDashboard(data) {
            currentData = data;
            const signalElement = document.getElementById('signalStatus');
            const descElement = document.getElementById('signalDescription');
            const actionElement = document.getElementById('actionRequired');
            if (data.strategy.signal === 'TQQQ') {
                signalElement.textContent = 'ğŸš€ è²·å…¥ TQQQ';
                signalElement.className = 'signal-status signal-tqqq';
                descElement.textContent = `QQQ åƒ¹æ ¼ ($${data.qqq.price}) é«˜æ–¼ 200æ—¥å‡ç·š ($${data.qqq.sma200})`;
                if (Math.abs(parseFloat(data.qqq.distance)) < 1) {
                    actionElement.style.display = 'block';
                    actionElement.textContent = 'âš ï¸ æ¥è¿‘å‡ç·šï¼Œå¯†åˆ‡é—œæ³¨ï¼';
                } else {
                    actionElement.style.display = 'none';
                }
            } else {
                signalElement.textContent = 'ğŸ’µ æŒæœ‰ç¾é‡‘';
                signalElement.className = 'signal-status signal-cash';
                descElement.textContent = `QQQ åƒ¹æ ¼ ($${data.qqq.price}) ä½æ–¼ 200æ—¥å‡ç·š ($${data.qqq.sma200})`;
                actionElement.style.display = 'none';
            }
            document.getElementById('qqqPrice').textContent = `$${data.qqq.price}`;
            document.getElementById('qqqSma200').textContent = `$${data.qqq.sma200}`;
            const distanceElement = document.getElementById('qqqDistance');
            distanceElement.textContent = `${data.qqq.distance}%`;
            distanceElement.className = `metric-value ${parseFloat(data.qqq.distance) >= 0 ? 'positive' : 'negative'}`;
            const qqqChangeElement = document.getElementById('qqqChange');
            qqqChangeElement.textContent = `${data.qqq.change}%`;
            qqqChangeElement.className = `metric-value ${parseFloat(data.qqq.change) >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('tqqqPrice').textContent = `$${data.tqqq.price}`;
            const tqqqChangeElement = document.getElementById('tqqqChange');
            tqqqChangeElement.textContent = `${data.tqqq.change}%`;
            tqqqChangeElement.className = `metric-value ${parseFloat(data.tqqq.change) >= 0 ? 'positive' : 'negative'}`;
            document.getElementById('tqqqVolatility').textContent = `${data.tqqq.volatility}%`;
            document.getElementById('tqqqRsi').textContent = data.tqqq.rsi;
            document.getElementById('monthlySignals').textContent = `${data.strategy.monthlySignals} æ¬¡`;
            document.getElementById('currentCycleDays').textContent = `${data.strategy.currentCycleDays} å¤©`;
            document.getElementById('tqqqHoldingRatio').textContent = `${data.strategy.holdingRatio}%`;
            document.getElementById('winRate').textContent = `${data.strategy.winRate}%`;
            document.getElementById('vixLevel').textContent = data.risk.vix;
            document.getElementById('trendStrength').textContent = data.risk.trendStrength;
            document.getElementById('drawdownRisk').textContent = data.risk.drawdownRisk;
            document.getElementById('signalStability').textContent = data.risk.signalStability;
            updateRecommendations(data);
            document.getElementById('lastUpdate').textContent = `æœ€å¾Œæ›´æ–°: ${data.lastUpdate}`;
            document.getElementById('loadingIndicator').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
            document.getElementById('dashboardContent').style.display = 'grid';
            document.getElementById('chartSection').style.display = 'block';
            updateChart(data);
        }

        function updateRecommendations(data) {
            const recommendations = [];
            if (data.strategy.signal === 'TQQQ') {
                recommendations.push('âœ… <strong>æŒæœ‰ TQQQ</strong>ï¼šå¸‚å ´è¶¨å‹¢å‘ä¸Šï¼Œç¹¼çºŒæŒæœ‰æ§“æ¡¿ETF');
                if (Math.abs(parseFloat(data.qqq.distance)) < 2) {
                    recommendations.push('âš ï¸ <strong>å¯†åˆ‡ç›£æ§</strong>ï¼šåƒ¹æ ¼æ¥è¿‘200æ—¥å‡ç·šï¼Œæº–å‚™èª¿æ•´å€‰ä½');
                }
                if (parseFloat(data.tqqq.rsi) > 70) {
                    recommendations.push('âš¡ <strong>è¶…è²·è­¦å‘Š</strong>ï¼šRSIåé«˜ï¼Œè€ƒæ…®éƒ¨åˆ†ç²åˆ©äº†çµ');
                }
            } else {
                recommendations.push('ğŸ’µ <strong>æŒæœ‰ç¾é‡‘</strong>ï¼šå¸‚å ´è¶¨å‹¢å‘ä¸‹ï¼Œé¿éšªç‚ºä¸»');
                recommendations.push('ğŸ‘€ <strong>ç­‰å¾…çªç ´</strong>ï¼šé—œæ³¨QQQé‡æ–°ç«™ä¸Š200æ—¥å‡ç·šçš„ä¿¡è™Ÿ');
            }
            if (parseFloat(data.risk.vix) > 25) {
                recommendations.push('ğŸš¨ <strong>é«˜æ³¢å‹•è­¦å‘Š</strong>ï¼šVIXå‡é«˜ï¼Œé™ä½é¢¨éšªæš´éœ²');
            }
            if (data.strategy.monthlySignals > 3) {
                recommendations.push('ğŸ“Š <strong>éœ‡ç›ªå¸‚å ´</strong>ï¼šä¿¡è™Ÿé »ç¹è®ŠåŒ–ï¼Œæ³¨æ„äº¤æ˜“æˆæœ¬');
            }
            document.getElementById('recommendations').innerHTML = recommendations.map(rec => `<div style="margin-bottom: 12px;">${rec}</div>`).join('');
        }

        function updateChart(data) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            if (chartInstance) {
                chartInstance.destroy();
            }
            const labels = data.historicalData.map(d => d.date);
            const prices = data.historicalData.map(d => d.price);
            const sma200Data = data.historicalData.map(d => d.sma200);
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'QQQ åƒ¹æ ¼', data: prices, borderColor: '#3b82f6', backgroundColor: 'rgba(59, 130, 246, 0.1)', borderWidth: 2, fill: false, tension: 0.2 },
                        { label: '200æ—¥å‡ç·š', data: sma200Data, borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', borderWidth: 2, fill: false, tension: 0.2, borderDash: [5, 5] }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { position: 'top', labels: { usePointStyle: true, padding: 20 } } },
                    scales: {
                        x: { display: true, grid: { display: false }, ticks: { maxTicksLimit: 10 } },
                        y: { display: true, grid: { color: 'rgba(0, 0, 0, 0.1)' } }
                    }
                }
            });
        }

        async function refreshData() {
            document.getElementById('loadingIndicator').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('chartSection').style.display = 'none';
            try {
                const data = await fetchMarketData();
                updateDashboard(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('errorAlert').style.display = 'block';
            }
        }

        // åˆå§‹è¼‰å…¥
        refreshData();
        // æ¯5åˆ†é˜è‡ªå‹•æ›´æ–°
        setInterval(refreshData, 5 * 60 * 1000);
        // é é¢å¯è¦‹æ€§è®ŠåŒ–æ™‚é‡æ–°è¼‰å…¥
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                refreshData();
            }
        });
    </script>
</body>
</html>
```
